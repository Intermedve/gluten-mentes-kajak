<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Glut√©nmentes √©telkeres≈ë</title>
  <style>
    :root{
      /* Vintage t√©ma */
      --bg: #F7F1E3;               /* pap√≠rszer≈± h√°tt√©r */
      --text: #3B2F2F;             /* sz√∂veg */
      --heading: #2F2424;          /* c√≠msorok */
      --card: #FFFAF3;             /* k√°rty√°k */
      --card-border: #E0D6C2;
      --shadow: 0 2px 6px rgba(55,37,15,0.15);

      --muted: #C9B99E;
      --accent: #8C6B4F;
      --accent-2: #C07A5A;

      --table-head: #EADDCF;

      --btn-green: #6B8F71;
      --btn-green-hover: #5C7C61;
      --btn-red: #B85C5C;
      --btn-red-hover: #A34E4E;

      --chipTextDark: #2B1F1F;
      --chipTextLight: #FBF7EF;
    }

    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      color: var(--text);
      background: var(--bg);
      line-height: 1.5;
    }
    h1, h2, h3 {
      color: var(--heading);
      margin-top: 0.2em;
      letter-spacing: 0.2px;
    }

    .card {
      background: var(--card);
      padding: 12px;
      margin: 6px 4px;
      border-radius: 10px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
      color: var(--text);
    }

    .result {
      margin-top: 10px;
      padding: 10px;
      background: var(--card);
      border-radius: 10px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      color: var(--text);
    }

    .ingredient-list {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .ingredient-item {
      padding: 6px 12px;
      border-radius: 14px;
      font-weight: bold;
      border: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 1px 2px rgba(0,0,0,0.08);
      /* a sz√≠nt √©s a text-color-t JS √°ll√≠tja */
    }

    .all-ingredients { margin-top: 20px; }
    .all-ingredient-item {
      padding: 10px 12px;
      margin-bottom: 6px;
      border-radius: 10px;
      font-weight: bold;
      border: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 1px 2px rgba(0,0,0,0.08);
      /* a sz√≠nt √©s a text-color-t JS √°ll√≠tja */
    }

    .slider-box {
      margin-top: 15px;
      padding: 12px;
      background: var(--card);
      border-radius: 10px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
    }

    /* T√°bl√°zat */
    table {
      border-collapse: collapse;
      width: 100%;
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
    }
    thead { background: var(--table-head); }
    th, td { padding: 10px; text-align: left; }
    tbody tr + tr td { border-top: 1px solid #eae2d6; }

    /* Gombok */
    .btn {
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 1px 2px rgba(0,0,0,0.15);
      transition: background 0.15s ease;
    }
    .btn-green { background: var(--btn-green); }
    .btn-green:hover { background: var(--btn-green-hover); }
    .btn-red { background: var(--btn-red); }
    .btn-red:hover { background: var(--btn-red-hover); }

    select.card { padding: 6px 10px; }

    /* Mobilbar√°t vez√©rl≈ësor a Heti √©tkez√©s tervez≈ën√©l */
    .planner-controls {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap; /* kisebb k√©perny≈ën t√∂rhessen √∫j sorba */
    }

    /* 640px alatt egym√°s al√° rendezz√ºk, teljes sz√©less√©gre */
    @media (max-width: 640px) {
      .planner-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }
      .planner-controls .btn,
      .planner-controls select.card,
      .planner-controls label {
        width: 100%;
      }
    }

    /* Heti t√°panyag √∂sszes√≠t≈ë t√°bl√°zat ‚Äì v√≠zszintes g√∂rget√©s kicsi kijelz≈ën */
    #weekTable {
      overflow-x: auto;
    }
    #weekTable table {
      min-width: 720px; /* ha a k√©perny≈ë enn√©l keskenyebb, g√∂rgethet≈ë lesz */
    }

  </style>
</head>
<body>
  <h1>Glut√©nmentes √©tel ‚Üí Bev√°s√°rl√≥lista</h1>
  <p>Ar√°nyos sk√°l√°z√°s cs√∫szk√°val, napi √©s heti tervel valamint √∂sszes√≠t√©ssel a bev√°s√°rl√≥list√°khoz.</p>

  <h2>√âtel ‚Üí sz√ºks√©ges alapanyagok</h2>
  <select id="reverseSelect" class="card"></select>
  <div id="scaleBox" class="slider-box" style="display:none">
    <label>Mennyis√©g szorz√≥: <span id="scaleValue">1.0√ó</span></label><br>
    <input type="range" id="scaleSlider" min="0.2" max="3" step="0.1" value="1">
  </div>

  <div id="reverseResult" class="result"></div>
  <div id="ingredientList" class="ingredient-list"></div>

  <div id="weeklyPlanner" style="margin-top:20px; margin-bottom:30px; box-shadow: var(--shadow);">
    <h2 style="margin-top:0; font-size:26px;">üìÖ Heti √©tkez√©s tervez≈ë</h2>
    <div class="card planner-controls" style="padding:15px;">
      <label><strong>Nap kiv√°laszt√°sa:</strong>
        <select id="daySelect" class="card" style="padding:5px 10px;">
          <option value="H√©tf≈ë">H√©tf≈ë</option>
          <option value="Kedd">Kedd</option>
          <option value="Szerda">Szerda</option>
          <option value="Cs√ºt√∂rt√∂k">Cs√ºt√∂rt√∂k</option>
          <option value="P√©ntek">P√©ntek</option>
          <option value="Szombat">Szombat</option>
          <option value="Vas√°rnap">Vas√°rnap</option>
        </select>
      </label>
      <button id="addToDayBtn" class="btn btn-green">‚ûï Hozz√°ad√°s</button>
      <button id="clearDayBtn" class="btn btn-red">üóëÔ∏è Kiv√°lasztott nap t√∂rl√©se</button>
    </div>

    <div id="weekTable" class="card" style="margin-top:20px; padding:20px; border-radius:12px;">
      <h3 style="font-size:22px; margin-bottom:15px;">Heti t√°panyag √∂sszes√≠t≈ë</h3>
      <table>
        <thead>
          <tr>
            <th>Nap</th>
            <th>√âtelek</th>
            <th>Hozz√°val√≥k (√∂sszes√≠tve)</th>
            <th style="text-align:center;">Kcal</th>
            <th style="text-align:center;">Feh√©rje</th>
            <th style="text-align:center;">Sz√©nhidr√°t</th>
            <th style="text-align:center;">Zs√≠r</th>
            <th style="text-align:center;">Rost</th>
          </tr>
        </thead>
        <tbody id="weekBody"></tbody>
      </table>
    </div>
  </div>

  <div id="weeklyShopping" class="card" style="margin-top:20px; padding:20px; border-radius:12px;">
    <h3 style="font-size:22px; margin-bottom:15px;">üõí Heti bev√°s√°rl√≥lista (√∂sszes nap)</h3>
    <div id="weeklyShoppingChips" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
  </div>
  
  <div id="ingredientLegend" class="card" style="margin-top:20px;">
    <h3>Jelmagyar√°zat a nem grammban √©rtelmezhet≈ë hozz√°val√≥khoz</h3>
    <ul>
      <li><strong>Toj√°s (S)</strong> ‚âà 50 g</li>
      <li><strong>Toj√°s (M)</strong> ‚âà 60 g</li>
      <li><strong>Toj√°s (L)</strong> ‚âà 70 g</li>
      <li><strong>Ol√≠vaolaj</strong> ‚Äì 1 ev≈ëkan√°l ‚âà 13.5 g</li>
    </ul>
  </div>

  <div id="allIngredients" class="all-ingredients"></div>

  <script>
    // Kontrasztos sz√∂vegsz√≠n sz√°m√≠t√°s a h√°tt√©r alapj√°n (WCAG-szer≈± luminancia)
    function hexToRgb(hex) {
      const s = hex.replace('#','').trim();
      const v = s.length === 3
        ? s.split('').map(c => parseInt(c + c, 16))
        : [parseInt(s.slice(0,2),16), parseInt(s.slice(2,4),16), parseInt(s.slice(4,6),16)];
      return { r: v[0], g: v[1], b: v[2] };
    }
    function relLuminance({r,g,b}) {
      const srgb = [r/255, g/255, b/255].map(v => v <= 0.03928 ? v/12.92 : Math.pow((v+0.055)/1.055, 2.4));
      return 0.2126*srgb[0] + 0.7152*srgb[1] + 0.0722*srgb[2];
    }
    function getReadableTextColor(bgHex) {
      try {
        const rgb = hexToRgb(bgHex);
        const L = relLuminance(rgb);
        // v√°ltsunk 0.5 k√∂r√ºl ‚Äì vil√°gos h√°tt√©ren s√∂t√©t sz√∂veg, s√∂t√©t h√°tt√©ren vil√°gos
        return L > 0.5 ? getComputedStyle(document.documentElement).getPropertyValue('--chipTextDark').trim() || '#2B1F1F'
                       : getComputedStyle(document.documentElement).getPropertyValue('--chipTextLight').trim() || '#FBF7EF';
      } catch(e) {
        return '#2B1F1F';
      }
    }

    const nutrientData = {
      // Letomp√≠tott, vintage √°rnyalatok
      "Lilak√°poszta": { gi: 10, kcal: 31, protein: 1.4, carbs: 5.3, fat: 0.2, fiber: 2.1, color: "#6C5A92" },
      "Burgonya": { gi: "70-90", kcal: 77, protein: 2, carbs: 17, fat: 0.1, fiber: 2.2, color: "#C9A54B" },
      "√âdesburgonya": { gi: "50-60", kcal: 86, protein: 1.6, carbs: 20, fat: 0.1, fiber: 3, color: "#C67A3C" },
      "Rizs": { gi: 70, kcal: 130, protein: 2.4, carbs: 28, fat: 0.3, fiber: 0.4, color: "#E9E1CC" },
      "K√∂les": { gi: 71, kcal: 119, protein: 3.5, carbs: 23.5, fat: 1, fiber: 1.3, color: "#E7D1A6" },
      "Hajdina": { gi: 54, kcal: 92, protein: 3.4, carbs: 20, fat: 0.6, fiber: 2, color: "#B69A7A" },
      "Quinoa": { gi: 53, kcal: 120, protein: 4.4, carbs: 21, fat: 1.9, fiber: 2.8, color: "#D7D1E1" },
      "Kukorica": { gi: 52, kcal: 96, protein: 3.2, carbs: 21, fat: 1.5, fiber: 2.7, color: "#E2CF5B" },
      "Kukoricaliszt": { gi: 70, kcal: 361, protein: 6.9, carbs: 76, fat: 3.9, fiber: 7.3, color: "#EFE2A9" },
      "Toj√°s": { gi: 0, kcal: 155, protein: 13, carbs: 1.1, fat: 11, fiber: 0, color: "#EDE4CF" },
      "Csirke": { gi: 0, kcal: 165, protein: 31, carbs: 0, fat: 3.6, fiber: 0, color: "#E7D6C8" },
      "Pulyka": { gi: 0, kcal: 135, protein: 29, carbs: 0, fat: 1, fiber: 0, color: "#E8D7B9" },
      "Sert√©s": { gi: 0, kcal: 143, protein: 20, carbs: 0, fat: 6, fiber: 0, color: "#A97C56" },
      "Marha": { gi: 0, kcal: 170, protein: 26, carbs: 0, fat: 7, fiber: 0, color: "#7E5639" },
      "Hal": { gi: 0, kcal: 208, protein: 20, carbs: 0, fat: 13, fiber: 0, color: "#9CB8C8" },
      "T√∫r√≥": { gi: 0, kcal: 98, protein: 12, carbs: 3.4, fat: 4.3, fiber: 0, color: "#CFCFCF" },
      "Tejf√∂l": { gi: 0, kcal: 205, protein: 3, carbs: 3.6, fat: 20, fiber: 0, color: "#BEBEBE" },
      "Sajt": { gi: 0, kcal: 350, protein: 24, carbs: 1.4, fat: 28, fiber: 0, color: "#C9A44A" },
      "Ol√≠vaolaj": { gi: 0, kcal: 884, protein: 0, carbs: 0, fat: 100, fiber: 0, color: "#6E7B4B" },
      "Vaj": { gi: 0, kcal: 717, protein: 0.9, carbs: 0.1, fat: 81, fiber: 0, color: "#D4B454" },
      "S√°rgar√©pa": { gi: 35, kcal: 41, protein: 0.9, carbs: 10, fat: 0.2, fiber: 2.8, color: "#D1823E" },
      "Brokkoli": { gi: 15, kcal: 34, protein: 2.8, carbs: 7, fat: 0.4, fiber: 2.6, color: "#558B55" },
      "Paprika": { gi: 10, kcal: 31, protein: 1, carbs: 6, fat: 0.3, fiber: 2.1, color: "#C2603D" },
      "Cukkini": { gi: 15, kcal: 17, protein: 1.2, carbs: 3.1, fat: 0.3, fiber: 1, color: "#7BA266" },
      "Alma": { gi: 36, kcal: 52, protein: 0.3, carbs: 14, fat: 0.2, fiber: 2.4, color: "#B4615E" },
      "Ban√°n": { gi: 51, kcal: 89, protein: 1.1, carbs: 23, fat: 0.3, fiber: 2.6, color: "#D2B75A" },
      "Narancs": { gi: 43, kcal: 47, protein: 0.9, carbs: 12, fat: 0.1, fiber: 2.4, color: "#D09248" },
      "Barnacukor": { gi: 64, kcal: 380, protein: 0, carbs: 98, fat: 0, fiber: 0, color: "#8B5A2B" },
      "Glut√©nmentes liszt": { gi: 70, kcal: 350, protein: 5, carbs: 78, fat: 1.5, fiber: 3, color: "#E6D8B5" },
      "S√ºt≈ëpor": { gi: 0, kcal: 53, protein: 0, carbs: 28, fat: 0, fiber: 0, color: "#DADADA" },
      "Kaka√≥por": { gi: 20, kcal: 228, protein: 19.6, carbs: 57.9, fat: 13.7, fiber: 33, color: "#5A3A2E" },
      "Tej": { gi: 27, kcal: 64, protein: 3.3, carbs: 4.8, fat: 3.5, fiber: 0, color: "#EFEFEF" },
      "S√≥": { gi: 0, kcal: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, color: "#D9D9D9" },
      "Bors": { gi: 0, kcal: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, color: "#5A5A5A" },
      "Majoranna": { gi: 0, kcal: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, color: "#7A8F5A" },
      "Spen√≥t": { gi: 15, kcal: 23, protein: 2.9, carbs: 3.6, fat: 0.4, fiber: 2.2, color: "#3E6B4E" },
      "Fokhagyma": { gi: 10, kcal: 149, protein: 6.4, carbs: 33, fat: 0.5, fiber: 2.1, color: "#E8E1C8" },
      "Csirke als√≥comb": { gi: 0, kcal: 174, protein: 18, carbs: 0, fat: 12, fiber: 0, color: "#E3CFC4" },
      "Csirke fels≈ëcomb": { gi: 0, kcal: 209, protein: 16, carbs: 0, fat: 16, fiber: 0, color: "#D8BEB0" },
      "Csirkesz√°rny": { gi: 0, kcal: 203, protein: 17, carbs: 0, fat: 15, fiber: 0, color: "#C9A99A" }
    };

    // ‚Üí √öj: alap gramm mennyis√©gek
    const recipes = [
      { name: "Rakott krumpli", needs: { "Burgonya": 600, "Toj√°s": 200, "Tejf√∂l": 150, "Sajt": 100 } },
      { name: "S√ºlt csirke rizzsel", needs: { "Csirke": 400, "Rizs": 200, "Ol√≠vaolaj": 20 } },
      { name: "Hajdina z√∂lds√©gekkel", needs: { "Hajdina": 200, "S√°rgar√©pa": 150, "Brokkoli": 200, "Ol√≠vaolaj": 20 } },
      { name: "Quinoa sal√°ta", needs: { "Quinoa": 200, "Paprika": 150, "Cukkini": 150, "Ol√≠vaolaj": 20 } },
      { name: "Kukoricam√°l√©", needs: { "Kukoricaliszt": 250, "Toj√°s": 100, "Vaj": 80 } },
      { name: "K√≠nai k√°poszt√°s toj√°s", needs: {"Toj√°s": 200,"Lilak√°poszta": 500, "Ol√≠vaolaj": 50}},
      { name: "Glut√©nmentes b√∂gr√©s s√ºti", needs: {"Toj√°s": 60, "Barnacukor": 18, "Glut√©nmentes liszt": 20, "S√ºt≈ëpor": 5, "Kaka√≥por": 4, "Tej": 22, "Ol√≠vaolaj": 13 }},
      { name: "Parajp√ºr√©", needs: {"Spen√≥t": 450, "Fokhagyma": 30, "Tej": 400, "Ol√≠vaolaj": 50, "Glut√©nmentes liszt": 40, "S√≥": 1, "Bors": 1, "Majoranna": 1}},
      { name: "S√ºlt csirke als√≥comb", needs: { "Csirke als√≥comb": 1500, "Ol√≠vaolaj": 100 } },
      { name: "S√ºlt csirke fels≈ëcomb", needs: { "Csirke fels≈ëcomb": 1500, "Ol√≠vaolaj": 100 } },
      { name: "S√ºlt csirkesz√°rny", needs: { "Csirkesz√°rny": 1500, "Ol√≠vaolaj": 100 } },
    ];

    const reverseSelect = document.getElementById("reverseSelect");
    const ingredientListDiv = document.getElementById("ingredientList");
    const allIngredientsDiv = document.getElementById("allIngredients");
    const scaleSlider = document.getElementById("scaleSlider");
    const scaleValue = document.getElementById("scaleValue");
    const scaleBox = document.getElementById("scaleBox");

    function refreshDropdown() {
      reverseSelect.innerHTML = '<option disabled selected value="">-- V√°lassz √©telt --</option>';
      recipes.forEach(r => reverseSelect.innerHTML += `<option value="${r.name}">${r.name}</option>`);
    }

    function renderAllIngredients() {
      allIngredientsDiv.innerHTML = '<h3>√ñsszes ismert hozz√°val√≥</h3>';
      for (const name in nutrientData) {
        const d = nutrientData[name];
        const div = document.createElement('div');
        div.className = 'all-ingredient-item';
        div.style.backgroundColor = d.color;
        div.style.color = getReadableTextColor(d.color);
        div.innerHTML = `<strong>${name}</strong> - GI: ${d.gi}, Kcal: ${d.kcal}, Feh√©rje: ${d.protein} g, Sz√©nhidr√°t: ${d.carbs} g, Zs√≠r: ${d.fat} g, Rost: ${d.fiber} g`;
        allIngredientsDiv.appendChild(div);
      }
    }

    refreshDropdown();
    renderAllIngredients();

    reverseSelect.addEventListener("change", () => {
      scaleSlider.value = 1;
      scaleValue.textContent = "1.0√ó";
      scaleBox.style.display = "block";
      updateView();
    });

    scaleSlider.addEventListener("input", updateView);

    function updateView() {
      const chosen = recipes.find(r => r.name === reverseSelect.value);
      if (!chosen) return;

      const multiplier = parseFloat(scaleSlider.value);
      scaleValue.textContent = multiplier.toFixed(1) + "√ó";

      const box = document.getElementById("reverseResult");
      ingredientListDiv.innerHTML = '';

      let html = `<div class="card"><strong>${chosen.name}</strong><br>Alap mennyis√©g sk√°l√°zva: ${multiplier.toFixed(1)}√ó</div>`;

      for (const ing in chosen.needs) {
        const baseGr = chosen.needs[ing];
        const currentGr = Math.round(baseGr * multiplier);
        const d = nutrientData[ing];

        if (!d) continue;

        const kcal = (d.kcal * currentGr / 100).toFixed(1);
        const protein = (d.protein * currentGr / 100).toFixed(1);
        const carbs = (d.carbs * currentGr / 100).toFixed(1);
        const fat = (d.fat * currentGr / 100).toFixed(1);
        const fiber = (d.fiber * currentGr / 100).toFixed(1);

        const fg = getReadableTextColor(d.color);

        html += `
        <div class="card" style="background-color:${d.color}; color:${fg}; border-color: rgba(0,0,0,0.08);">
          <strong>${ing}</strong> ‚Äì ${currentGr} g<br>
          GI: ${d.gi}<br>
          Kcal: ${kcal}<br>
          Feh√©rje: ${protein} g<br>
          Sz√©nhidr√°t: ${carbs} g<br>
          Zs√≠r: ${fat} g<br>
          Rost: ${fiber} g
        </div>`;

        const tag = document.createElement('div');
        tag.className = 'ingredient-item';
        tag.textContent = ing + " (" + currentGr + " g)";
        tag.style.backgroundColor = d.color;
        tag.style.color = fg;
        ingredientListDiv.appendChild(tag);
      }

      box.innerHTML = html;
    }
  </script>

  <script>
    const weekData = {
      "H√©tf≈ë": { items: [], ingredients: {}, kcal:0, protein:0, carbs:0, fat:0, fiber:0},
      "Kedd": { items: [], ingredients: {}, kcal:0, protein:0, carbs:0, fat:0, fiber:0},
      "Szerda": { items: [], ingredients: {}, kcal:0, protein:0, carbs:0, fat:0, fiber:0},
      "Cs√ºt√∂rt√∂k": { items: [], ingredients: {}, kcal:0, protein:0, carbs:0, fat:0, fiber:0},
      "P√©ntek": { items: [], ingredients: {}, kcal:0, protein:0, carbs:0, fat:0, fiber:0},
      "Szombat": { items: [], ingredients: {}, kcal:0, protein:0, carbs:0, fat:0, fiber:0},
      "Vas√°rnap": { items: [], ingredients: {}, kcal:0, protein:0, carbs:0, fat:0, fiber:0}
    };

    function renderWeek() {
      const tbody = document.getElementById('weekBody');
      tbody.innerHTML = '';
      for (const day in weekData) {
        const d = weekData[day];

        const ingChips = Object.entries(d.ingredients || {}).map(([name, grams]) => {
          const color = (nutrientData[name] && nutrientData[name].color) ? nutrientData[name].color : '#8E8E8E';
          const fg = getReadableTextColor(color);
          return `<div class="ingredient-item" style="background-color:${color}; color:${fg}; margin:3px 6px 3px 0;">${name} (${grams} g)</div>`;
        }).join('');

        tbody.innerHTML += `<tr>
          <td style="vertical-align:top; font-weight:bold;">${day}</td>
          <td style="vertical-align:top;">${d.items.map(i => `<div style='margin-bottom:4px;'>${i}</div>`).join('')}</td>
          <td style="vertical-align:top;">
            <div style="display:flex; flex-wrap:wrap;">${ingChips}</div>
          </td>
          <td style="text-align:center; vertical-align:top;">${d.kcal.toFixed(1)}</td>
          <td style="text-align:center; vertical-align:top;">${d.protein.toFixed(1)}</td>
          <td style="text-align:center; vertical-align:top;">${d.carbs.toFixed(1)}</td>
          <td style="text-align:center; vertical-align:top;">${d.fat.toFixed(1)}</td>
          <td style="text-align:center; vertical-align:top;">${d.fiber.toFixed(1)}</td>
        </tr>`;
      }

      renderWeeklyShopping();
    }

    renderWeek();

    document.getElementById('clearDayBtn').addEventListener('click', ()=>{
      const day = document.getElementById('daySelect').value;
      weekData[day] = { items:[], ingredients:{}, kcal:0, protein:0, carbs:0, fat:0, fiber:0 };
      renderWeek();
    });

    document.getElementById('addToDayBtn').addEventListener('click', () => {
      const chosen = recipes.find(r => r.name === document.getElementById("reverseSelect").value);
      if (!chosen) return alert('V√°lassz ki egy √©telt!');

      const multiplier = parseFloat(document.getElementById("scaleSlider").value);
      const day = document.getElementById('daySelect').value;

      let totals = {kcal:0, protein:0, carbs:0, fat:0, fiber:0};
      for (const ing in chosen.needs) {
        const baseGr = chosen.needs[ing];
        const currentGr = Math.round(baseGr * multiplier);
        const d = nutrientData[ing];
        if (!d) continue;

        totals.kcal += d.kcal * currentGr / 100;
        totals.protein += d.protein * currentGr / 100;
        totals.carbs += d.carbs * currentGr / 100;
        totals.fat += d.fat * currentGr / 100;
        totals.fiber += d.fiber * currentGr / 100;

        if (!weekData[day].ingredients[ing]) weekData[day].ingredients[ing] = 0;
        weekData[day].ingredients[ing] += currentGr;
      }

      weekData[day].kcal += totals.kcal;
      weekData[day].protein += totals.protein;
      weekData[day].carbs += totals.carbs;
      weekData[day].fat += totals.fat;
      weekData[day].fiber += totals.fiber;

      weekData[day].items.push(chosen.name + " (" + multiplier.toFixed(1) + "√ó)");

      renderWeek();
    });

    function getWeeklyIngredients() {
      const weekly = {};
      for (const day in weekData) {
        const ingMap = weekData[day].ingredients || {};
        for (const name in ingMap) {
          if (!weekly[name]) weekly[name] = 0;
          weekly[name] += ingMap[name];
        }
      }
      return weekly;
    }

    function renderWeeklyShopping() {
      const container = document.getElementById('weeklyShoppingChips');
      if (!container) return;
      const weekly = getWeeklyIngredients();
      const entries = Object.entries(weekly);

      if (entries.length === 0) {
        container.innerHTML = '<div class="card" style="background:#F3EEE3; color:#5A4A42;">Nincs m√©g t√©tel. Adj hozz√° √©teleket a napokhoz!</div>';
        return;
      }

      entries.sort((a,b)=> a[0].localeCompare(b[0],'hu'));

      container.innerHTML = entries.map(([name, grams]) => {
        const color = (nutrientData[name] && nutrientData[name].color) ? nutrientData[name].color : '#8E8E8E';
        const fg = getReadableTextColor(color);
        return `<div class="ingredient-item" style="background-color:${color}; color:${fg}; margin:3px 6px 3px 0;">${name} (${grams} g)</div>`;
      }).join('');
    }
  </script>

</body>
</html>
